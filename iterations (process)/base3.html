<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Scheduling Application</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
        }
        .highlight {
            background-color: yellow;
            border-color: orange;
            color: black;
        }
        td:hover {
            background-color: #ffff99;
        }

        .gray-out {
        background-color: #cccccc !important;
        }
        .green-highlight {
        background-color: #00FF00;
        }
</style>

    </style>
</head>
<body>
    <h1>Sanj and Rez Weekly Scheduling</h1>
    <div class="container mt-5">
        <button id="clearSelection" class="btn btn-warning">Clear Selection</button>
        <form action="/rankings" method="post">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Time</th>
                        <th scope="col">Monday</th>
                        <th scope="col">Tuesday</th>
                        <th scope="col">Wednesday</th>
                        <th scope="col">Thursday</th>
                        <th scope="col">Friday</th>
                        <th scope="col">Saturday</th>
                        <th scope="col">Sunday</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>9-10 AM</td> 
                        <td id="monday-9-10"></td> 
                        <td id="tuesday-9-10"></td>
                        <td id="wednesday-9-10"></td>
                        <td id="thursday-9-10"></td>
                        <td id="friday-9-10"></td>
                        <td id="saturday-9-10"></td>
                        <td id="sunday-9-10"></td>
                    </tr>
                    <tr>
                        <td>10-11 AM</td>
                        <td id="monday-10-11"></td> 
                        <td id="tuesday-10-11"></td>
                        <td id="wednesday-10-11"></td>
                        <td id="thursday-10-11"></td>
                        <td id="friday-10-11"></td>
                        <td id="saturday-10-11"></td>
                        <td id="sunday-10-11"></td>
                    </tr>
                    <tr>
                        <td>11-12 PM</td>
                        <td id="monday-11-12"></td>
                        <td id="tuesday-11-12"></td>
                        <td id="wednesday-11-12"></td>
                        <td id="thursday-11-12"></td>
                        <td id="friday-11-12"></td>
                        <td id="saturday-11-12"></td>
                        <td id="sunday-11-12"></td>
                    </tr>
                    <tr>
                        <td>12-1 PM</td>
                        <td id="monday-12-1"></td> 
                        <td id="tuesday-12-1"></td>
                        <td id="wednesday-12-1"></td>
                        <td id="thursday-12-1"></td>
                        <td id="friday-12-1"></td>
                        <td id="saturday-12-1"></td>
                        <td id="sunday-12-1"></td>
                    </tr>
                    <tr>
                        <td>1-2 PM</td>
                        <td id="monday-1-2"></td>
                        <td id="tuesday-1-2"></td>
                        <td id="wednesday-1-2"></td>
                        <td id="thursday-1-2"></td>
                        <td id="friday-1-2"></td>
                        <td id="saturday-1-2"></td>
                        <td id="sunday-1-2"></td>
                    </tr>
                    <tr>
                        <td>2-3 PM</td>
                        <td id="monday-2-3"></td> 
                        <td id="tuesday-2-3"></td>
                        <td id="wednesday-2-3"></td>
                        <td id="thursday-2-3"></td>
                        <td id="friday-2-3"></td>
                        <td id="saturday-2-3"></td>
                        <td id="sunday-2-3"></td>
                    </tr>
                    <tr>
                        <td>3-4 PM</td>
                        <td id="monday-3-4"></td> 
                        <td id="tuesday-3-4"></td>
                        <td id="wednesday-3-4"></td>
                        <td id="thursday-3-4"></td>
                        <td id="friday-3-4"></td>
                        <td id="saturday-3-4"></td>
                        <td id="sunday-3-4"></td>
                    </tr>
                    <tr>
                        <td>4-5 PM</td>
                        <td id="monday-4-5"></td> 
                        <td id="tuesday-4-5"></td>
                        <td id="wednesday-4-5"></td>
                        <td id="thursday-4-5"></td>
                        <td id="friday-4-5"></td>
                        <td id="saturday-4-5"></td>
                        <td id="sunday-4-5"></td>
                    </tr>
                    <tr>
                        <td>5-6 PM</td>
                        <td id="monday-5-6"></td> 
                        <td id="tuesday-5-6"></td>
                        <td id="wednesday-5-6"></td>
                        <td id="thursday-5-6"></td>
                        <td id="friday-5-6"></td>
                        <td id="saturday-5-6"></td>
                        <td id="sunday-5-6"></td>
                    </tr>
                    <tr>
                        <td>6-7 PM</td>
                        <td id="monday-6-7"></td> 
                        <td id="tuesday-6-7"></td>
                        <td id="wednesday-6-7"></td>
                        <td id="thursday-6-7"></td>
                        <td id="friday-6-7"></td>
                        <td id="saturday-6-7"></td>
                        <td id="sunday-6-7"></td>
                    </tr>
                    <tr>
                        <td>7-8 PM</td>
                        <td id="monday-7-8"></td> 
                        <td id="tuesday-7-8"></td>
                        <td id="wednesday-7-8"></td>
                        <td id="thursday-7-8"></td>
                        <td id="friday-7-8"></td>
                        <td id="saturday-7-8"></td>
                        <td id="sunday-7-8"></td>
                    </tr>
                    <tr>
                        <td>8-9 PM</td>
                        <td id="monday-8-9"></td> 
                        <td id="tuesday-8-9"></td>
                        <td id="wednesday-8-9"></td>
                        <td id="thursday-8-9"></td>
                        <td id="friday-8-9"></td>
                        <td id="saturday-8-9"></td>
                        <td id="sunday-8-9"></td>
                    </tr>
                </tbody>
            </table>
        <button id="nextButton" class="btn btn-primary" style="display: none;">Next</button>
        <button id="saveSelection" class="btn btn-success">Save Selection</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            let isDragging = false; // Indicates if we are currently dragging
            let selectionAllowed = true; // Initially, selection is allowed
            let reselectPhase = false; 
            let dragStartState = null;
        
            // Clear Selection button logic
            $('#clearSelection').click(function() {
                $('.highlight, .green-highlight').removeClass('highlight green-highlight');
                $('.table td').removeClass('gray-out'); // Remove gray-out from all cells
                selectionAllowed = true; // Re-enable selection
                reselectPhase = false;
            });
        
            // Save Selection button logic
            $('#saveSelection').click(function(e) {
                e.preventDefault();
                $('.table td').not('.highlight').addClass('gray-out'); // Gray out unhighlighted cells
                selectionAllowed = false; // Disable further selection
                reselectPhase = true; // Enable reselection phase
                alert("Please select your most preferred time slots from your previous selections.");
            });
        
            // Mouse events for cell selection
            $('.table td').mousedown(function(e) {
                if (!selectionAllowed && !reselectPhase) return;
        
                e.preventDefault();
                isDragging = true;
                if (reselectPhase && $(this).hasClass('highlight')) {
                    dragStartState = 'select'; // We are starting the drag with the intention to select (turn green)
                    $(this).addClass('green-highlight').removeClass('highlight'); // Apply green highlight immediately
                }
            }).mouseenter(function() {
                if (!isDragging) return;
        
                if (reselectPhase && dragStartState === 'select') {
                    if ($(this).hasClass('highlight') || $(this).hasClass('green-highlight')) {
                        $(this).addClass('green-highlight').removeClass('highlight');
                    }
                } else if (selectionAllowed) {
                    $(this).toggleClass('highlight', selectionAllowed);
                }
            });
        
            $(document).on('mouseup', function() {
                isDragging = false;
                dragStartState = null; // Reset the drag start state
            });
        
            function resetSelection() {
                $('.highlight, .green-highlight').removeClass('highlight green-highlight');
                $('.table td').removeClass('gray-out');
                selectionAllowed = true;
                reselectPhase = false;
                $('#nextButton').hide(); // Hide the Next button
            }
        });
        </script>        
</body>
</html>